<?php

foreach ($result as $index => $val) {
	$indexVal[] = $index;
}
$impolde = implode(',', (array) $result);
$impoldeInd = implode(',', (array) $indexVal);

use Laminas\Session\Container;
use Application\Service\CommonService;


$sessionLogin = new Container('credo');
$roleCode = $sessionLogin->roleCode;
$recencyTestResults = '';
$section = 'Section 1/2';
$recencyTestResultsBlock = 'style="display:none;"';
if ($roleCode == 'remote_order_user') {
	$recencyTestResults = 'style="display:none;"';
	$recencyTestResultsBlock = '';
	$section = 'Section 1/1';
}
$common = new CommonService();
$dob = '';
$file_open_date = '';

if ($result['risk_population'] == 'Other') {
	$riskDisplay = 'class="col-sm-2"';
	$otherRiskDisplay = 'style=" display:block; "';
	$otherRequired = 'isRequired';
} else {
	$riskDisplay = 'class="col-sm-4"';
	$otherRiskDisplay = 'style=" display:none; "';
	$otherRequired = '';
}
$hivDiagnosisDate = '';
if ($result['hiv_diagnosis_date'] != '' && $result['hiv_diagnosis_date'] != null && $result['hiv_diagnosis_date'] != '0000-00-00') {
	$hivDiagnosisDate = $common->humanDateFormat($result['hiv_diagnosis_date']);
}
$hivRecencyTestDate = '';
if ($result['hiv_recency_test_date'] != '' && $result['hiv_recency_test_date'] != null && $result['hiv_recency_test_date'] != '0000-00-00') {
	$hivRecencyTestDate = $common->humanDateFormat($result['hiv_recency_test_date']);
}
$dob = '';
if ($result['dob'] != '' && $result['dob'] != null && $result['dob'] != '0000-00-00') {
	$dob = $common->humanDateFormat($result['dob']);
}

$testKitExpiryDate = '';
if ($result['kit_expiry_date'] != '' && $result['kit_expiry_date'] != null && $result['kit_expiry_date'] != '0000-00-00') {
	$testKitExpiryDate = $common->humanDateFormat($result['kit_expiry_date']);
}

$vlTestDateRes = '';
if ($result['vl_test_date'] != '' && $result['vl_test_date'] != null && $result['vl_test_date'] != '0000-00-00') {
	$vlTestDateRes = $common->humanDateFormat($result['vl_test_date']);
}

$sampleCollectionDate = '';
if ($result['sample_collection_date'] != '' && $result['sample_collection_date'] != null && $result['sample_collection_date'] != '0000-00-00') {
	$sampleCollectionDate = $common->humanDateFormat($result['sample_collection_date']);
}
$sampleReceiptDate = '';
if ($result['sample_receipt_date'] != '' && $result['sample_receipt_date'] != null && $result['sample_receipt_date'] != '0000-00-00') {
	$sampleReceiptDate = $common->humanDateFormat($result['sample_receipt_date']);
}

$sampleReceivedDate = '';
if ($result['sample_received_date'] != '' && $result['sample_received_date'] != null && $result['sample_received_date'] != '0000-00-00') {
	$sampleReceivedDate = $common->humanDateFormat($result['sample_received_date']);
}

$arr = array();
// now we create an associative array so that we can easily create view variables
for ($i = 0; $i < sizeof($globalConfigResult); $i++) {
	$arr[$globalConfigResult[$i]['global_name']] = $globalConfigResult[$i]['global_value'];
}
$resultArr = array();
//Set selected field
if (isset($arr['mandatory_fields']) && trim($arr['mandatory_fields']) != '') {
	$resultArr = explode(",", $arr['mandatory_fields']);
}

$resultArr2 = array();
if (isset($arr['display_fields']) && trim($arr['display_fields']) != '') {
	$resultArr2 = explode(",", $arr['display_fields']);
}

$sample = in_array("Sample Id", $resultArr) ? "isRequired" : "";
$patient = in_array("Patient Id", $resultArr) ? "isRequired" : "";
$facility = in_array("Facility Name", $resultArr) ? "isRequired" : "";
$hivDiagnosisRequiredDate = in_array("Hiv Diagnosis Date", $resultArr) ? "isRequired" : "";
$hivRecencyRequiredDate = in_array("Hiv Recency Test Date", $resultArr) ? "isRequired" : "";
$controlLineResult = in_array("Verification Line", $resultArr) ? "isRequired" : "";
$positiveVerificationLine = in_array("Verification Line", $resultArr) ? "isRequired" : "";
$longTermVerificationLine = in_array("Long Term Line", $resultArr) ? "isRequired" : "";
$dobRequired = in_array("Dob", $resultArr) ? "isRequired" : "";
$age = in_array("Age", $resultArr) ? "isRequired" : "";
$gender = in_array("Gender", $resultArr) ? "isRequired" : "";
$locationOne = in_array("Province", $resultArr) ? "isRequired" : "";
$locationTwo = in_array("District", $resultArr) ? "isRequired" : "";
$locationThree = in_array("City", $resultArr) ? "isRequired" : "";
$residence = in_array("Residence", $resultArr) ? "isRequired" : "";
$marital = in_array("Marital Status", $resultArr) ? "isRequired" : "";
$education = in_array("Education Level", $resultArr) ? "isRequired" : "";
$risk = in_array("Risk Population", $resultArr) ? "isRequired" : "";
$pregnancy = in_array("Pregnancy Status", $resultArr) ? "isRequired" : "";
$partner = in_array("Current Sexual Partner", $resultArr) ? "isRequired" : "";
$testing = in_array("Past Hiv Testing", $resultArr) ? "isRequired" : "";
$hivStatus = in_array("Last HIV Status", $resultArr) ? "isRequired" : "";
$patientArt = in_array("Patient on ART", $resultArr) ? "isRequired" : "";
$last = in_array("Test Last 12 Month", $resultArr) ? "isRequired" : "";
$expViolence = in_array("Experience Violence Last 12 Month", $resultArr) ? "isRequired" : "";
$comment = in_array("Comments", $resultArr) ? "isRequired" : "";
$kitName = in_array("Test Kit Name", $resultArr) ? "isRequired" : "";
$kitLotNo = in_array("Test Kit Lot No", $resultArr) ? "isRequired" : "";
$KitExpiryDate = in_array("Kit Expiry Date", $resultArr) ? "isRequired" : "";
$testerName = in_array("Tester Name", $resultArr) ? "isRequired" : "";

$vlTestDate = in_array("Viral Load Test Date", $resultArr) ? "isRequired" : "";
$vlLoadResult = in_array("Viral Load Result", $resultArr) ? "isRequired" : "";
$testingFacility = in_array("Testing Facility", $resultArr) ? "isRequired" : "";



$sampleCollectionDateMandatory = in_array("Sample Collection Date from the Client", $resultArr) ? "isRequired" : "";
$sampleReceiptDateMandatory  = in_array("Sample Receipt Date at the Recency Testing Site", $resultArr) ? "isRequired" : "";
$receivedSpecimenTypeMandatory = in_array("Received Specimen Type", $resultArr) ? "isRequired" : "";
$sampleReceivedDateMandatory = in_array("Sample Received Date", $resultArr) ? "isRequired" : "";
$testingModality = in_array("Testing Modality", $resultArr) ? "isRequired" : "";

$lineOutComeColor = "#de1d2b";
$lineOutComeColor2 = "#000000";
?>
<style>
	<?php
	if ($result['term_outcome'] == '') {
	?>.outcome {
		visibility: hidden;
	}

	<?php
	}
	?>.btnHide,
	.hivResultStatusShow,
	.hideFields {
		display: none;
	}

	.btnHide,
	.hivResultStatusShow,
	.vlResultoutcome.hideFields {
		display: none;
	}

	showFields {
		display: block;
	}

	.colour {
		color: red;
	}

	/* Search Start*/
	/* .typeahead { border: 1px solid #d4d4d4;border-radius: 4px;background: #ffff;padding: 8px 12px;max-width: 300px;min-width: 290px;
color: #495057;}
input.typeahead {min-width: 265px;}
.tt-menu { width:300px; }
ul.typeahead{margin:0px;padding:0px;background: #fafafa;}
.dropdown-item.active, .dropdown-item:active {color: #fff;text-decoration: none;background-color: #68bced !important;
}
ul.typeahead.dropdown-menu li a {padding: 10px !important;	border-bottom:#d4d4d4 1px solid;color:black;}
ul.typeahead.dropdown-menu li:last-child a { border-bottom:0px !important; } */
	/* Search End */
</style>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/assets/css/select2-new.min.css' ?>">
<div class="bg-body-light">
	<div class="content content-full">
		<div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center">
			<h1 class="flex-sm-fill font-size-h2 font-w400 mt-2 mb-0 mb-sm-2">Recency</h1>
			<nav class="flex-sm-00-auto ml-sm-3" aria-label="breadcrumb">
				<ol class="breadcrumb">
					<a href="<?php echo $this->url('recency', array('action' => 'index')); ?>">
						<li class="breadcrumb-item">Recency Details</li>
					</a>
					<li class="breadcrumb-item active" aria-current="page">&nbsp;/ Edit</li>
				</ol>
			</nav>
		</div>
	</div>
</div>

<!-- Start -->
<div class="content">
	<div class="block block-rounded block-bordered">
		<div class="block-header block-header-default">
			<h3 class="block-title">Edit Recency Details</h3>
		</div>

		<!--  Start Tab view-->
		<div class="row">
			<div class="col-md-12">
				<div class="js-wizard-simple block block block-rounded block-bordered">
					<ul class="nav nav-tabs nav-tabs-block nav-justified" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" href="javascript:void(0)" id="step1" onclick="validateStep2()"> <?php echo $section; ?> <i class="fa fa-check stepOne" style="color:green;visibility:hidden;"></i></a>
						</li>
						<li class="nav-item" <?php echo $recencyTestResults; ?>>
							<a class="nav-link" href="javascript:void(0)" id="step2" onclick="validateStep1();"> Section 2/2 <i class="fa fa-check stepTwo" style="color:green;visibility:hidden;"></i></a>
						</li>
					</ul>
					<form name="recencyInformation" id="recencyInformation" class="mb-5" action="<?php echo $this->url('recency', array('action' => 'edit')); ?>" method="post">
						<div class="block-content block-content-sm">
						</div>
						<div class="block-content block-content-full tab-content" style="min-height: 300px;">
							<?php
							if (isset($arr['admin_message']) && $arr['admin_message'] != '') {
							?>
								<h4><?php echo ucwords($arr['admin_message']); ?></h4>
							<?php
							}
							?>
							<div class="tab-pane active" id="wizard-progress-step1" role="tabpanel">

								<div class="col-md-12">
									<div class="block block-rounded block-bordered">
										<div class="block-header block-header-default">
											<h3 class="block-title">Sample Information</h3>
										</div>
										<br>



										<div class="form-group row form-horizontal col-sm-12 col-lg-12">
											<label class="col-sm-2 col-form-label <?php echo in_array("Sample Id", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Sample ID<?php echo (in_array("Sample Id", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Sample Id", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<input type="text" value="<?php echo $result['sample_id']; ?>" class="form-control <?php echo $sample;
																																	echo in_array("Sample Id", $resultArr2) ? "showFields" : "hideFields"; ?>" id="sampleId" name="sampleId" placeholder="Enter the sample id" title="Please enter the sample id" readonly />
											</div>
											<label class="col-sm-2 col-form-label <?php echo in_array("Patient Id", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Unique Patient ID/UPID<?php echo (in_array("Patient Id", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Patient Id", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<input type="text" value="<?php echo $result['patient_id']; ?>" editPatientId="<?php echo $result['patient_id']; ?>" class="form-control <?php echo $patient;
																																															echo in_array("Patient Id", $resultArr2) ? "showFields" : "hideFields"; ?>" id="patientId" name="patientId" placeholder="Enter the patient id" title="Please enter the patient id" onblur="checkPatientIdValidation()">
												<small class="text-danger">&nbsp;Please do not enter Patient Name</small><br>
												<small class="text-danger patientIdError" style="display: none;">&nbsp;Patient Id should be 19 characters except special chars</small>
											</div>
										</div>
										<div class="form-group row form-horizontal col-sm-12 col-lg-12">
											<label class="col-sm-2 col-form-label <?php echo in_array("Sample Collection Date from the Client", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Sample Collection Date from the Client <?php echo (in_array("Sample Collection Date from the Client", $resultArr) ? "<span class='mandatory'>*</span>" : ""); ?> </label>
											<div class="col-sm-4 <?php echo in_array("Sample Collection Date from the Client", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<input type="text" class="form-control <?php echo $sampleCollectionDateMandatory; ?> <?php echo in_array("Sample Collection Date from the Client", $resultArr2) ? "showFields" : "hideFields"; ?>" value="<?php echo $sampleCollectionDate; ?>" id="sampleCollectionDate" name="sampleCollectionDate" placeholder="Enter the sample collection date" readonly="readonly" title="Please enter the sample collection date">
											</div>

											<label class="col-sm-2 col-form-label <?php echo in_array("Received Specimen Type", $resultArr2) ? "showFields" : "hideFields"; ?>" for=""> Specimen Type <?php echo (in_array("Received Specimen Type", $resultArr) ? "<span class='mandatory'>*</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Received Specimen Type", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $receivedSpecimenTypeMandatory; ?> <?php echo in_array("Received Specimen Type", $resultArr2) ? "showFields" : "hideFields"; ?>" id="receivedSpecimenType" name="receivedSpecimenType" title="Enter the received specimen type">
													<option value="">--Select--</option>
													<?php foreach ($sampleTypes as $sampleType) { ?>
														<option value="<?php echo $sampleType['sample_id']; ?>" <?php echo ($sampleType['sample_id'] == $result['received_specimen_type']) ? 'selected="selected"' : ''; ?>><?php echo $sampleType['sample_name']; ?></option>
													<?php } ?>

												</select>
											</div>

										</div>


										<div class="form-group row  form-horizontal col-sm-12 col-lg-12">

											<label class="col-sm-2 col-form-label <?php echo in_array("Testing Facility", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Testing Facility<?php echo (in_array("Testing Facility", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Testing Facility", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $testingFacility; ?>" id="testingFacilityId" name="testingFacilityId" title="Please select the testing facility">
													<option value="">--Select--</option>
													<?php foreach ($facilityResult['facilityTest'] as $testingFacility) { ?>
														<option value="<?php echo base64_encode($testingFacility['facility_id']); ?>" <?php echo ($testingFacility['facility_id'] == $result['testing_facility_id']) ? 'selected="selected"' : ''; ?>><?php echo ucwords($testingFacility['facility_name']); ?></option>
													<?php } ?>
													<!-- <option value="other">Other</option> -->
												</select>
												&nbsp;
												<input style="display:none;" type="text" class="form-control col-sm-12" id="otherTestingFacility" name="otherTestingFacility" title="Please Enter facility name" value="" placeholder="Enter facility name">
												&nbsp;
											</div>
											<!-- <label class="col-sm-2 col-form-label <?php //echo in_array("Sample Received Date",$resultArr2)?"showFields":"hideFields";
																						?>" for="">Sample Received Date<?php //echo(in_array("Sample Received Date",$resultArr)?"<span class='mandatory'>*</span>":"");
																														?> </label>
                                        <div class="col-sm-4 <?php //echo in_array("Sample Received Date",$resultArr2)?"showFields":"hideFields";
																?>">
                                            <input type="text" class="js-datepicker form-control <?php //echo $sampleReceivedDateMandatory;
																									?> <?php // echo in_array("Sample Received Date",$resultArr2)?"showFields":"hideFields";
																										?>"  value="<?php //echo $sampleReceivedDate;
																													?>" id="sampleReceivedDate" name="sampleReceivedDate" placeholder="Enter the sample received date" data-autoclose="true" data-today-highlight="true" data-date-format="dd-M-yyyy"  readonly="readonly" title="Please enter the sample received date">
                                        </div> -->

										</div>




									</div>
								</div>



								<div class="col-md-12">
									<div class="block block-rounded block-bordered">
										<div class="block-header block-header-default">
											<h3 class="block-title">Client Location</h3>
										</div>
										<br>
										<div class="form-group row form-horizontal col-sm-12">
											<label class="col-sm-2 col-form-label <?php echo in_array("Facility Name", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Facility Name<?php echo (in_array("Facility Name", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Facility Name", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control  <?php echo $facility; ?>" id="facilityId" name="facilityId" title="Please select the facility name" onchange="getLocationDataByFacility()">
													<option value="">--Select--</option>
													<?php foreach ($facilityResult['facility'] as $facility) { ?>
														<option value="<?php echo base64_encode($facility['facility_id']); ?>" <?php echo ($result['facility_id'] == $facility['facility_id']) ? 'selected="selected"' : ''; ?>><?php echo ucwords($facility['facility_name']); ?></option>
													<?php } ?>
													<!-- <option value="other">Other</option> -->
												</select>
												&nbsp;
												<input style="display:none;" type="text" class="form-control col-sm-12" id="otherFacilityName" name="otherFacilityName" title="Please Enter facility name" value="" placeholder="Enter facility name">
												&nbsp;
											</div>

											<label style=" margin-bottom: 4%; " class="col-sm-2 col-form-label <?php echo in_array("Province", $resultArr2) ? "showFields" : "hideFields"; ?>" for=""><?php echo ucfirst($globalConfigResult[0]['global_value']); ?><?php echo (in_array("Province", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Province", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $locationOne; ?>" id="<?php echo $globalConfigResult[0]['global_name']; ?>" name="<?php echo $globalConfigResult[0]['global_name']; ?>" placeholder="Enter the <?php echo lcfirst($globalConfigResult[0]['global_value']); ?>" title="Please enter the <?php echo lcfirst($globalConfigResult[0]['global_value']); ?>" onchange="getLocationDeatils('<?php echo $globalConfigResult[0]['global_name']; ?>',null,null,null);">
													<option value="">-- Select --</option>
												</select>
											</div>

											<label style=" margin-bottom: 4%; " class="col-sm-2 col-form-label <?php echo in_array("District", $resultArr2) ? "showFields" : "hideFields"; ?>" for=""><?php echo ucfirst($globalConfigResult[1]['global_value']); ?><?php echo (in_array("District", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("District", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $locationTwo; ?>" id="<?php echo $globalConfigResult[1]['global_name']; ?>" name="<?php echo $globalConfigResult[1]['global_name']; ?>" placeholder="Enter the <?php echo lcfirst($globalConfigResult[1]['global_value']); ?>" title="Please enter the <?php echo lcfirst($globalConfigResult[1]['global_value']); ?>" onchange="getLocationDeatils('<?php echo $globalConfigResult[1]['global_name']; ?>',null,null,null);">
													<option value="">-- Select --</option>
												</select>
												&nbsp;
												<input style="display:none;" type="text" class="form-control col-sm-12" id="otherDistrictName" name="otherDistrictName" title="Please Enter district name" value="" placeholder="Enter district name">
												&nbsp;
											</div>

											<label style=" margin-bottom: 4%; " class="col-sm-2 col-form-label <?php echo in_array("City", $resultArr2) ? "showFields" : "hideFields"; ?>" for=""><?php echo ucfirst($globalConfigResult[2]['global_value']); ?><?php echo (in_array("City", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("City", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $locationThree; ?>" id="<?php echo $globalConfigResult[2]['global_name']; ?>" name="<?php echo $globalConfigResult[2]['global_name']; ?>" placeholder="Enter the <?php echo lcfirst($globalConfigResult[2]['global_value']); ?>" title="Please enter the <?php echo lcfirst($globalConfigResult[2]['global_value']); ?>" onchange="getLocationDeatils('<?php echo $globalConfigResult[2]['global_name']; ?>',null,null,null);">
													<option value="">-- Select --</option>
												</select>
												&nbsp;
												<input style="display:none;" type="text" class="form-control col-sm-12" id="otherCityName" name="otherCityName" title="Please Enter city name" value="" placeholder="Enter city name">
												&nbsp;
											</div>
										</div>
									</div>
								</div>


								<div class="col-md-12">
									<div class="block block-rounded block-bordered">
										<div class="block-header block-header-default">
											<h3 class="block-title">HIV Diagnosis Test</h3>
										</div>
										<br>
										<div class="form-group row form-horizontal col-sm-12">

											<label class="col-sm-2 col-form-label <?php echo in_array("Hiv Diagnosis Date", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">HIV Diagnosis Date<?php echo (in_array("Hiv Diagnosis Date", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Hiv Diagnosis Date", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<input type="text" value="<?php echo $hivDiagnosisDate; ?>" class="form-control  <?php echo $hivDiagnosisRequiredDate; ?>" id="hivDiagnosisDate" name="hivDiagnosisDate" data-week-start="1" data-autoclose="true" data-today-highlight="true" data-date-format="dd-M-yyyy" value="" placeholder="Enter the HIV diagnosis date" title="Please enter the HIV diagnosis date" readonly="readonly">
											</div>
											<br>

											<label class="col-sm-2 col-form-label <?php echo in_array("Past Hiv Testing", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Past HIV Testing<?php echo (in_array("Past Hiv Testing", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Past Hiv Testing", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $testing; ?>" id="pastHivTesting" name="pastHivTesting" title="Please enter the past HIV testing" onchange="checkHivTesting(this);">
													<option value="">--Select--</option>
													<option value="yes" <?php echo ($result['past_hiv_testing'] == 'yes') ? 'selected="selected"' : ''; ?>>Yes</option>
													<option value="no" <?php echo ($result['past_hiv_testing'] == 'no') ? 'selected="selected"' : ''; ?>>No</option>
													<option value="not_known" <?php echo ($result['past_hiv_testing'] == 'not_known') ? 'selected="selected"' : ''; ?>>Not Known</option>
												</select>
											</div>

											<label class="col-sm-2 col-form-label hivResultStatusShow <?php echo in_array("Test Last 12 Month", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Test Last 12 Month<?php echo (in_array("Test Last 12 Month", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 hivResultStatusShow <?php echo in_array("Test Last 12 Month", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $last; ?>" id="testLast12Month" name="testLast12Month" title="Please enter the test last 12 month">
													<option value="">--Select--</option>
													<option value="yes" <?php echo ($result['test_last_12_month'] == 'yes') ? 'selected="selected"' : ''; ?>>Yes</option>
													<option value="no" <?php echo ($result['test_last_12_month'] == 'no') ? 'selected="selected"' : ''; ?>>No</option>
													<option value="not_known" <?php echo ($result['test_last_12_month'] == 'not_known') ? 'selected="selected"' : ''; ?>>Not Known</option>
												</select>
											</div>
											<label class="col-sm-2 col-form-label hivResultStatusShow <?php echo in_array("Last HIV Status", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Last HIV Status <?php echo (in_array("Last HIV Status", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 hivResultStatusShow <?php echo in_array("Last HIV Status", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $hivStatus; ?>" id="lastHivStatus" name="lastHivStatus" title="Please choose the last HIV Status" onchange="checkHivStatus(this);">
													<option value="">--Select--</option>
													<option value="negative" <?php echo ($result['last_hiv_status'] == 'negative') ? 'selected="selected"' : ''; ?>>Negative</option>
													<option value="positive" <?php echo ($result['last_hiv_status'] == 'positive') ? 'selected="selected"' : ''; ?>>Positive</option>
												</select>
											</div>
											<label class="col-sm-2 col-form-label hivResultStatusShow" for="patientOnArt">Is the Patient on ART? <?php echo (in_array("Patient on ART", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 hivResultStatusShow">
												<select class="form-control <?php echo $patientArt; ?>" id="patientOnArt" name="patientOnArt" title="Please choose patient on ART or Not" disabled>
													<option value="">--Select--</option>
													<option value="yes" <?php echo ($result['patient_on_art'] == 'yes') ? 'selected="selected"' : ''; ?>>Yes</option>
													<option value="no" <?php echo ($result['patient_on_art'] == 'no') ? 'selected="selected"' : ''; ?>>No</option>
												</select>
											</div>






											<label class="col-sm-2 col-form-label <?php echo in_array("Testing Modality", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Testing Modality <?php echo (in_array("Testing Modality", $resultArr) ? "<span class='mandatory'>*</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Testing Modality", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control <?php echo $testingModality; ?>" id="testingModality" name="testingModality" title="Please select the testing modality type">
													<option value="">--Select--</option>

													<?php foreach ($testFacilityTypeResult as $testingFacilityType) { ?>
														<option value="<?php echo $testingFacilityType['testing_facility_type_id']; ?>" <?php echo ($testingFacilityType['testing_facility_type_id'] == $result['testing_facility_type']) ? 'selected="selected"' : ''; ?>><?php echo $testingFacilityType['testing_facility_type_name']; ?></option>
													<?php } ?>
													<option value="other">Other</option>
												</select>
												&nbsp;
												<input style="display:none;" type="text" class="form-control col-sm-12" id="othertestingmodality" name="othertestingmodality" title="Please Enter testing modality type" value="" placeholder="Enter testing modality type">
												&nbsp;
											</div>

											<br>
											<br>
											<br>
										</div>
									</div>
								</div>

								<div class="col-md-12">

									<div class="block block-rounded block-bordered">
										<div class="block-header block-header-default">
											<h3 class="block-title">Patient Details</h3>
										</div>
										<br>
										<div class="form-group row form-horizontal col-sm-12 col-lg-12">
											<label class="col-sm-2 col-form-label <?php echo in_array("Dob", $resultArr2) ? "showFields" : "hideFields"; ?>" for="dob">DOB<?php echo (in_array("Dob", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Dob", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<input type="text" value="<?php echo $dob; ?>" class="form-control section2" id="dob" name="dob" value="" placeholder="Patient DOB" title="Please enter the dob" onchange="ageCalculate();" readonly="readonly" <?php echo ($result['age_not_reported'] == 'yes') ? 'disabled' : ""; ?>>
											</div>

											<label class="col-sm-2 col-form-label <?php echo in_array("Age", $resultArr2) ? "showFields" : "hideFields"; ?>" for="age">Age in Years <?php echo (in_array("Age", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Age", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<input type="text" value="<?php echo $result['age']; ?>" class="form-control section2" id="age" name="age" value="" onchange="this.value = minmax(this.value, 15, 120)" placeholder="Patient age (min. 15 years)" title="Please enter the age" <?php echo ($result['age_not_reported'] == 'yes') ? 'disabled' : ""; ?>>
											</div>
										</div>
										<br>
										<div class="form-group row form-horizontal col-sm-12">
											<label class="col-sm-2 col-form-label <?php echo in_array("Gender", $resultArr2) ? "showFields" : "hideFields"; ?>" for="gender">Gender<?php echo (in_array("Gender", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Gender", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control section2" id="gender" name="gender" title="Please select the gender" onchange="genderCheck(this);">
													<option value="">--Select--</option>
													<option value="male" <?php echo ($result['gender'] == 'male') ? 'selected="selected"' : ''; ?>>Male</option>
													<option value="female" <?php echo ($result['gender'] == 'female') ? 'selected="selected"' : ''; ?>>Female</option>
													<option value="not_reported" <?php echo ($result['gender'] == 'not_reported') ? 'selected="selected"' : ''; ?>>Not Reported</option>
												</select>
											</div>

											<label class="col-sm-2 form-check-label" for="ageNotReported">Age Not Reported</label>
											<div class="col-sm-4">
												&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="form-check-input" style="border:none;" name="ageNotReported" id="ageNotReported" value="yes" onchange="ageNotReport(this);" <?php echo ($result['age_not_reported'] == 'yes') ? 'checked="checked"' : ""; ?> />&nbsp;Yes
											</div>

											<label class="col-sm-2 col-form-label hidePregnancyResult <?php echo in_array("Pregnancy Status", $resultArr2) ? "showFields" : "hideFields"; ?>" for="pregnancyStatus">Pregnancy Status<?php echo (in_array("Pregnancy Status", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 hidePregnancyResult <?php echo in_array("Pregnancy Status", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control section2 <?php echo in_array("Pregnancy Status", $resultArr2) ? "showFields" : "hideFields"; ?>" id="pregnancyStatus" name="pregnancyStatus" title="Please select the pregnancy status">
													<option value="">--Select--</option>
													<option value="currently_pregnant" <?php echo ($result['pregnancy_status'] == 'currently_pregnant') ? 'selected="selected"' : ''; ?>>Currently Pregnant</option>
													<option value="not_pregnant" <?php echo ($result['pregnancy_status'] == 'not_pregnant') ? 'selected="selected"' : ''; ?>>Not Pregnant</option>
													<option value="not_known" <?php echo ($result['pregnancy_status'] == 'not_known') ? 'selected="selected"' : ''; ?>>Not Known</option>
												</select>
											</div>
										</div>
										<div class="form-group row form-horizontal col-sm-12">
											<label class="col-sm-2 col-form-label <?php echo in_array("Marital Status", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Marital Status<?php echo (in_array("Marital Status", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Marital Status", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control section2" id="maritalStatus" name="maritalStatus" title="Please select the marital status">
													<option value="">--Select--</option>
													<option value="never_married" <?php echo ($result['marital_status'] == 'never_married') ? 'selected="selected"' : ''; ?>>Never Married</option>
													<option value="married_cohabited" <?php echo ($result['marital_status'] == 'married_cohabited') ? 'selected="selected"' : ''; ?>>Married - Cohabited</option>
													<option value="married_cohabiting" <?php echo ($result['marital_status'] == 'married_cohabiting') ? 'selected="selected"' : ''; ?>>Married cohabiting</option>
													<option value="widow" <?php echo ($result['marital_status'] == 'widow') ? 'selected="selected"' : ''; ?>>Widow</option>
													<option value="divorce_separated" <?php echo ($result['marital_status'] == 'divorce_separated') ? 'selected="selected"' : ''; ?>>Divorce - Separated</option>
												</select>
											</div>
											<label class="col-sm-2 col-form-label <?php echo in_array("Education Level", $resultArr2) ? "showFields" : "hideFields"; ?>" for="educationLevel">Education Level<?php echo (in_array("Education Level", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Education Level", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control section2" id="educationLevel" name="educationLevel" title="Please select the education level">
													<option value="">--Select--</option>
													<option value="primary" <?php echo ($result['education_level'] == 'primary') ? 'selected="selected"' : ''; ?>>Primary</option>
													<option value="secondary" <?php echo ($result['education_level'] == 'secondary') ? 'selected="selected"' : ''; ?>>Secondary</option>
													<option value="university_or_higher" <?php echo ($result['education_level'] == 'university_or_higher') ? 'selected="selected"' : ''; ?>>University or Higher</option>
												</select>
											</div>
										</div>
										<br>
										<div class="form-group row form-horizontal col-sm-12">
											<label class="col-sm-2 col-form-label <?php echo in_array("Risk Population", $resultArr2) ? "showFields" : "hideFields"; ?>" for="riskPopulation">Risk Population<?php echo (in_array("Risk Population", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div id="riskPopulationSelect" class="<?php echo in_array("Risk Population", $resultArr2) ? "showFields" : "hideFields"; ?>" <?php echo $riskDisplay; ?>>
												<select class="form-control section2 <?php echo in_array("Risk Population", $resultArr2) ? "showFields" : "hideFields"; ?>" id="riskPopulation" name="riskPopulation" title="Please select the risk population" onchange="riskPopulationCheck(this);">
													<option value="">--Select--</option>
													<?php foreach ($facilityResult['riskPopulations'] as $riskPo) { ?>
														<option value="<?php echo base64_encode($riskPo['rp_id']); ?>" <?php echo ($result['risk_population'] == $riskPo['rp_id']) ? 'selected="selected"' : ''; ?>><?php echo $riskPo['name']; ?></option>
													<?php } ?>
													<option value="Other">Other</option>
												</select>

												<input style="display:none;" type="text" class="form-control col-sm-12 section2" id="otherRiskPopulation" name="otherRiskPopulation" title="Please Enter the Other Risk Population" value="" placeholder="Enter other population">
											</div>

											<label class="col-sm-2 col-form-label <?php echo in_array("Residence", $resultArr2) ? "showFields" : "hideFields"; ?>" for="residence">Residence<?php echo (in_array("Residence", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Residence", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control section2" id="residence" name="residence" title="Please select the residence">
													<option value="">--Select--</option>
													<option value="urban" <?php echo ($result['residence'] == 'urban') ? 'selected="selected"' : ''; ?>>Urban</option>
													<option value="rural" <?php echo ($result['residence'] == 'rural') ? 'selected="selected"' : ''; ?>>Rural</option>
												</select>
												<br>
											</div>

											<label class="col-sm-2 col-form-label  <?php echo in_array("Current Sexual Partner", $resultArr2) ? "showFields" : "hideFields"; ?>" for="currentSexualPartner">Current Sexual Partner<?php echo (in_array("Current Sexual Partner", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4  <?php echo in_array("Current Sexual Partner", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control section2" id="currentSexualPartner" name="currentSexualPartner" title="Please select the current sexual partner">
													<option value="">--Select--</option>
													<option value="1" <?php echo ($result['current_sexual_partner'] == '1') ? 'selected="selected"' : ''; ?>>1</option>
													<option value="2_3" <?php echo ($result['current_sexual_partner'] == '2_3') ? 'selected="selected"' : ''; ?>>2 - 3</option>
													<option value=">3" <?php echo ($result['current_sexual_partner'] == '>3') ? 'selected="selected"' : ''; ?>>>3</option>
												</select>
											</div>

											<label class="col-sm-2 col-form-label <?php echo in_array("Experience Violence Last 12 Month", $resultArr2) ? "showFields" : "hideFields"; ?>" for="expViolence">Experienced violence in last 12 months <?php echo (in_array("experience Violence Last 12 Month", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Experience Violence Last 12 Month", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<select class="form-control section2" id="expViolence" name="expViolence" title="Please select the experienced violence in last 12 months">
													<option value="">--Select--</option>
													<option value="yes" <?php echo ($result['exp_violence_last_12_month'] == 'yes') ? 'selected="selected"' : ''; ?>>Yes</option>
													<option value="no" <?php echo ($result['exp_violence_last_12_month'] == 'no') ? 'selected="selected"' : ''; ?>>No</option>
													<option value="not_known" <?php echo ($result['exp_violence_last_12_month'] == 'not_known') ? 'selected="selected"' : ''; ?>>Don't know</option>
												</select>
											</div>

											<label class="col-sm-2 col-form-label <?php echo in_array("Comments", $resultArr2) ? "showFields" : "hideFields"; ?>" for="comments">Comments <?php echo (in_array("Comments", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
											<div class="col-sm-4 <?php echo in_array("Comments", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<textarea class="form-control section2" name="comments" id="comments" title="Please enter comments"><?php echo $result['notes']; ?></textarea>
											</div>

										</div>
									</div>
								</div>


								<!-- <div class="col-md-12">
									<div class="block block-rounded block-bordered">
										<div class="block-header block-header-default">
											<h3 class="block-title">Testing Results </h3>
										</div>
										<br> -->
								<div class="form-group row form-horizontal col-sm-12">


								</div>
								<!-- </div>
								</div> -->
							</div>
							<?php if ($recencyTestResults != "") {
								$hivRecencyRequiredDate = "";
								$disbaledResult = "";
								$testNotPermform = "";
								$testingFacility = "";
								$hivRecencyTestDate = "";
								$kitLotNo = "";
								$KitExpiryDate = "";
								$controlLineResult = "";
								$positiveVerificationLine = "";
								$longTermVerificationLine = "";
								$vlTestDate = "";
								$vlLoadResult = "";
							} else {
								$disbaledResult = "disbaledResult ";
							} ?>
							<div class="tab-pane" <?php echo $recencyTestResults; ?> id="wizard-progress-step2" role="tabpanel">
								<div name="recencySectionForm2" id="recencySectionForm2" class="mb-5">
									<div class="block-header block-header-default">
										<h3 class="block-title">Recency Test Results</h3>
									</div>
									<br>
									<div class="form-group row form-horizontal col-sm-12">
										<label class="col-sm-2 form-check-label <?php echo in_array("Recency Test not performed", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Recency Test not performed </label>
										<div class="col-sm-4 <?php echo in_array("Recency Test not performed", $resultArr2) ? "showFields" : "hideFields"; ?>">
											&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="form-check-input" style="border:none;" name="recencyTestPerformed" id="recencyTestPerformedYes" <?php echo ($result['recency_test_performed'] == 'true') ? 'checked="checked"' : ''; ?> value="true" />&nbsp;Yes
										</div>

										<!-- Other Non Performed test -->
										<label style="visibility:hidden;" class="col-sm-2 col-form-label hideDiv" for="">Reason of Recency Test Not Performed
											<?php echo (in_array("Recency Test Not Performed", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?>
										</label>
										<div style="visibility:hidden;" class="col-sm-4 hideDiv">
											<select class="form-control" id="recencyTestNotPerformed" name="recencyTestNotPerformed" title="Please select the recency test not performed" onchange="otherRecencyTestNotPerfomedCheck(this);">
												<option value="">--Select--</option>
												<option value="no_consent_from_the_client" <?php echo ($result['recency_test_not_performed'] == 'no_consent_from_the_client') ? 'selected="selected"' : ''; ?>>No Consent</option>
												<option value="no_sample_collected" <?php echo ($result['recency_test_not_performed'] == 'no_sample_collected') ? 'selected="selected"' : ''; ?>>No Sample Collected</option>
												<option value="newly_not_diagnosed" <?php echo ($result['recency_test_not_performed'] == 'newly_not_diagnosed') ? 'selected="selected"' : ''; ?>>No New Diagnosis</option>
												<option value="other" <?php echo ($result['recency_test_not_performed'] == 'other') ? 'selected="selected"' : ''; ?>>Others</option>
											</select>
											<br>
											<input style="<?php echo ($result['recency_test_not_performed'] == 'other') ? 'display:block;' : 'display:none;'; ?>" value="<?php echo $result['other_recency_test_not_performed']; ?>" type="text" class="form-control col-sm-12" id="otherRecencyTestNotPerformed" name="otherRecencyTestNotPerformed" title="Please Enter the Other other recency test not performed" placeholder="Enter other recency test not performed">
											<br>
										</div>


										<label class="col-sm-2 col-form-label <?php echo in_array("Tester Name", $resultArr2) ? "showFields" : "hideFields"; ?>" for="testerName">Tester Name <?php echo (in_array("Tester Name", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Tester Name", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<input type="text" value="<?php echo $result['tester_name']; ?>" class="typeahead form-control <?php echo $testerName; ?>" id="testerName" name="testerName" placeholder="Enter the tester name" title="Please enter the tester name">
										</div>
										<?php if ($roleCode != 'remote_order_user') { ?>
											<label class="col-sm-2 col-form-label <?php echo in_array("Sample Receipt Date at the Recency Testing Site", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Sample Receipt Date at the Recency Testing Site <?php echo (in_array("Sample Receipt Date at the Recency Testing Site", $resultArr) ? "<span class='mandatory'>*</span>" : ""); ?> </label>
											<div class="col-sm-4 <?php echo in_array("Sample Receipt Date at the Recency Testing Site", $resultArr2) ? "showFields" : "hideFields"; ?>">
												<input type="text" class="form-control <?php echo $sampleReceiptDateMandatory; ?> <?php echo in_array("Sample Receipt Date at the Recency Testing Site", $resultArr2) ? "showFields" : "hideFields"; ?>" value="<?php echo $sampleReceiptDate; ?>" id="sampleReceiptDate" name="sampleReceiptDate" placeholder="Enter the sample receipt date" readonly="readonly" title="Please enter the sample receipt date">
											</div>
										<?php } ?>





										<label class="col-sm-2 col-form-label <?php echo in_array("Hiv Recency Test Date", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">HIV Recency Test Date<?php echo (in_array("Hiv Recency Test Date", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Hiv Recency Test Date", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<input type="text" value="<?php echo $hivRecencyTestDate; ?>" class="form-control <?php echo $disbaledResult . $hivRecencyRequiredDate; ?>" id="hivRecencyTestDate" name="hivRecencyTestDate" data-week-start="1" data-autoclose="true" data-today-highlight="true" data-date-format="dd-M-yyyy" value="" placeholder="Enter the HIV recency Test date" title="Please enter the HIV recency Test date" readonly="readonly" onchange="getTestKitLot()">
										</div>
										<br>
										<br>
										<br>

										<label class="col-sm-2 col-form-label <?php echo in_array("Test Kit Lot No", $resultArr2) ? "showFields" : "hideFields"; ?>" for="testKitLotNo">Test Kit Lot Number <?php echo (in_array("Test Kit Lot No", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Test Kit Lot No", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<select class="form-control <?php echo $disbaledResult . $kitLotNo; ?>" id="testKitLotNo" name="testKitLotNo" title="Please select the kit lot no" onchange="testKitLotNoChange(this);">
												<option value="">--Select--</option>

											</select>
											<input type="text" value="<?php echo $testKitExpiryDate; ?>" class="form-control hideFields" id="testKitExpDate" name="testKitExpDate" placeholder="Please select the kit lot no" title="Please select the kit lot no" readonly="readonly">
										</div>



										<label class="col-sm-2 col-form-label <?php echo in_array("Control Line", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Control Line
											<?php echo (in_array("Control Line", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Control Line", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<select class="form-control invalidctline
													<?php echo $disbaledResult . $controlLineResult;
													echo in_array("Control Line", $resultArr2) ? "showFields" : "hideFields"; ?>" id="controlLine" name="controlLine" title="Please select the control line" onchange="changeTermLine()">
												<option value="">--Select--</option>
												<option value="present" <?php echo ($result['control_line'] == 'present') ? 'selected="selected"' : ''; ?>>Present</option>
												<option value="absent" <?php echo ($result['control_line'] == 'absent') ? 'selected="selected"' : ''; ?>>Absent</option>
											</select>
										</div>

										<label class="col-sm-2 col-form-label <?php echo in_array("Verification Line", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Verification Line
											<?php echo (in_array("Verification Line", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Verification Line", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<select class="form-control invalidctline <?php echo $disbaledResult . $positiveVerificationLine; ?>" id="positiveVerificationLine" name="positiveVerificationLine" title="Please select the verification line" onchange="changeTermLine()">
												<option value="">--Select--</option>
												<option value="present" <?php echo ($result['positive_verification_line'] == 'present') ? 'selected="selected"' : ''; ?>>Present(Positive/P)</option>
												<option value="absent" <?php echo ($result['positive_verification_line'] == 'absent') ? 'selected="selected"' : ''; ?>>Absent(Negative/N)</option>
											</select>
										</div>
										<br>
										<br>
										<br>
										<label class="col-sm-2 col-form-label <?php echo in_array("Long Term Line", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Long Term Line
											<?php echo (in_array("Long Term Line", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Long Term Line", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<select class="form-control invalidctline <?php echo $disbaledResult . $longTermVerificationLine; ?>" id="longTermVerificationLine" name="longTermVerificationLine" title="Please select the long term line" onchange="changeTermLine()">
												<option value="">--Select--</option>
												<option value="present" <?php echo ($result['long_term_verification_line'] == 'present') ? 'selected="selected"' : ''; ?>>Present(Long Term/LT)</option>
												<option value="absent" <?php echo ($result['long_term_verification_line'] == 'absent') ? 'selected="selected"' : ''; ?>>Absent(Recent/R)</option>
											</select>
										</div>
										<br>


										<label class="col-sm-2 col-form-label <?php echo in_array("Viral Load Test Date", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Viral Load Test Date <?php echo (in_array("Viral Load Test Date", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Viral Load Test Date", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<input type="text" value="<?php echo $vlTestDateRes; ?>" class="vlResultFields form-control <?php echo $vlTestDate; ?>" id="vlTestDate" name="vlTestDate" data-week-start="1" data-autoclose="true" data-today-highlight="true" data-date-format="dd-M-yyyy" placeholder="Enter the Viral Load Test Date" title="Please enter Viral Load Test Date" readonly="readonly" disabled onblur="updateVlResultFields('vlField')">
										</div>


										<label class="col-sm-2 col-form-label outcome " style="visibility:hidden" for="">Assay Outcome</label>
										<div class="col-sm-4">
											<span class="form-control" style="border:none;" id="outcome"></span>
											<input type="hidden" name="outcomeData" id="outcomeData" value="<?php echo $result['term_outcome']; ?>" />
										</div>
										<br>
										<div class="actualresult row" style="display: none;background-color: aliceblue;margin-left: 10px;margin-top: 20px;margin-bottom: 20px;padding: 20px;">
											<label class="col-sm-2 col-form-label" for="controlLineActual">Control Line <span class='mandatory'>*</span></label>
											<div class="col-sm-4">
												<select class="form-control actualresult-input" id="controlLineActual" name="controlLineActual" title="Please select the control line" onchange="changeTermLineActual()">
													<option value="">--Select--</option>
													<option value="present" <?php echo ($result['invalid_control_line'] == 'present') ? 'selected="selected"' : ''; ?>>Present</option>
													<option value="absent" <?php echo ($result['invalid_control_line'] == 'absent') ? 'selected="selected"' : ''; ?>>Absent</option>
												</select>
											</div>
											<label class="col-sm-2 col-form-label" for="positiveVerificationLineActual">Verification Line<span class='mandatory'>*</span></label>
											<div class="col-sm-4">
												<select class="form-control actualresult-input" id="positiveVerificationLineActual" name="positiveVerificationLineActual" title="Please select the long term line" onchange="changeTermLineActual()">
													<option value="">--Select--</option>
													<option value="present" <?php echo ($result['invalid_verification_line'] == 'present') ? 'selected="selected"' : ''; ?>>Present(Positive/P)</option>
													<option value="absent" <?php echo ($result['invalid_verification_line'] == 'absent') ? 'selected="selected"' : ''; ?>>Absent(Negative/N)</option>
												</select>
											</div>
											<label class="col-sm-2 col-form-label" for="longTermVerificationLineActual">Long Term Line <span class='mandatory'>*</span></label>
											<div class="col-sm-4">
												<select class="form-control actualresult-input" id="longTermVerificationLineActual" name="longTermVerificationLineActual" title="Please select the long term line" onchange="changeTermLineActual()">
													<option value="">--Select--</option>
													<option value="present" <?php echo ($result['invalid_longterm_line'] == 'present') ? 'selected="selected"' : ''; ?>>Present(Long Term/LT)</option>
													<option value="absent" <?php echo ($result['invalid_longterm_line'] == 'absent') ? 'selected="selected"' : ''; ?>>Absent(Recent/R)</option>
												</select>
											</div>
											<label class="col-sm-2 col-form-label outcomeActual" style="visibility:hidden" for="outcomeDataActual">Assay Outcome Actual </label>
											<div class="col-sm-4">
												<span class="form-control" style="border:none;background-color: transparent;" id="outcomeActual"><?php echo $result['term_outcome']; ?></span>
												<input type="hidden" class="actualresult-input" name="outcomeDataActual" value="<?php echo $result['final_outcome']; ?>" id="outcomeDataActual" />
											</div>
										</div>
										<label class="col-sm-2 col-form-label <?php echo in_array("Viral Load Result", $resultArr2) ? "showFields" : "hideFields"; ?>" for="">Viral Load Result (cp/ml)<?php echo (in_array("Viral Load Result", $resultArr) ? "<span class='mandatory'> *</span>" : ""); ?></label>
										<div class="col-sm-4 <?php echo in_array("Viral Load Result", $resultArr2) ? "showFields" : "hideFields"; ?>">
											<?php
											$vlResultOptionAry = array('TND', 'BDL', 'failed', '< 20', '< 40');
											$vlResultTextValue = (in_array($result['vl_result'], $vlResultOptionAry)) ? '' : $result['vl_result'];
											?>
											<input type="text" value="<?php echo $vlResultTextValue; ?>" class=" form-control vlResultFields <?php echo $vlLoadResult; ?>" id="vlLoadResult" name="vlLoadResult" placeholder="Enter the Viral Load Result (cp/ml)" title="Please enter the Viral Load Result (cp/ml)" onblur="updateVlResultFields('vlField')" disabled />


											<div class="text-center" style="padding:2px 0px 2px 0px">OR</div>
											<select class="form-control vlResultFields vlResultOption" name="vlResultOption" id="vlResultOption" disabled onchange="updateVlResultFields('vlField')">
												<option value="">-- Select -- </option>
												<option value="TND" <?php echo ($result['vl_result'] == 'TND') ? 'selected="selected"' : ''; ?>>TND - Target not detected</option>
												<option value="BDL" <?php echo ($result['vl_result'] == 'BDL') ? 'selected="selected"' : ''; ?>>BDL - Below Detection Line</option>
												<option value="failed" <?php echo ($result['vl_result'] == 'failed') ? 'selected="selected"' : ''; ?>>Failed</option>
												<option value="< 20" <?php echo ($result['vl_result'] == '< 20') ? 'selected="selected"' : ''; ?>>
													< 20</option>
												<option value="< 40" <?php echo ($result['vl_result'] == '< 40') ? 'selected="selected"' : ''; ?>>
													< 40</option>
											</select>
										</div>

										<label class="col-sm-2 col-form-label vlResultoutcome " style="visibility:hidden" for="">Final Outcome</label>
										<div class="col-sm-4  vlResultoutcome" style="visibility:hidden">
											<span class=" form-control " style="border:none;" id="vlResultoutcome"></span>
											<input type="hidden" name="vlfinaloutcomeResult" id="vlfinaloutcomeResult" />
										</div>




										<br>
										<br>
										<br>


										<br>
										<br>
									</div>



								</div>
							</div>
						</div>
						<!-- END Steps Content -->
						<div class="block-content block-content-sm block-content-full bg-body-light rounded-bottom">
							<div class="row">
								<div class="col-6">
									<button type="button" class="btn btn-secondary btnHide" onclick="validateStep2()">
										<i class="fa fa-angle-left mr-1"></i> Previous
									</button>

									<a href="<?php echo $this->url('recency', array('action' => 'index')); ?>" class="btn btn-danger d-none btnHide" data-wizard="finish">Cancel</a>&nbsp;
									<button type="submit" class="btn btn-primary d-none btnHide" data-wizard="finish" onclick="validateNow();return false;"><i class="fa fa-check mr-1"></i> Submit</button>
								</div>
								<div class="col-6 text-right" <?php echo $recencyTestResultsBlock; ?>>

									<a href="<?php echo $this->url('recency', array('action' => 'index')); ?>" class="btn btn-danger d-none " data-wizard="finish">Cancel</a>&nbsp;
									<button type="submit" class="btn btn-primary d-none " data-wizard="finish" onclick="validateNow();return false;"><i class="fa fa-check mr-1"></i> Submit</button>
								</div>
								<div class="col-6 text-right" <?php echo $recencyTestResults; ?>>
									<button type="button" class="btn btn-secondary nxtBtn" onclick="validateStep1();">
										Next <i class="fa fa-angle-right ml-1"></i>
									</button>

									<input type="hidden" name="oldRecords" value="<?php echo $impolde; ?>" />
									<input type="hidden" name="oldRecordsInd" value="<?php echo $impoldeInd; ?>" />
									<input type="hidden" name="recencyId" value="<?php echo $result['recency_id']; ?>" />
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!--  end tab view-->
	</div>
</div>
<!-- End -->
<!-- <script src="< ?php// echo $this->basePath() . '/assets/js/plugins/namesearch/typeahead.js'; ?>"></script> -->
<script src="<?php echo $this->basePath() . '/assets/js/plugins/moment/moment.min.js'; ?>"></script>
<script src="<?php echo $this->basePath() . '/assets/js/select2.full.min.js'; ?>"></script>
<script type="text/javascript">
	$(".hideFields").remove();
	$(document).ready(function() {
		$("#testingFacilityId").select2({
			placeholder: "Choose Testing Site",
			width: "260px",
			allowClear: true,
		});
		$("#testKitLotNo").select2({
			placeholder: "Choose Test Kit Lot No",
			width: "260px",
			allowClear: true,
		});
		$("#testingModality").select2({
			placeholder: "Choose Testing Modality",
			width: "260px",
			allowClear: true,
		});
		<?php if ($result['gender'] == 'male') { ?>
			$(".hidePregnancyResult").css('display', 'none');
			$("#pregnancyStatus").removeClass('isRequired');
		<?php } else if ($result['gender'] == 'female') { ?>
			$(".hidePregnancyResult").css('display', 'block');
			$("#pregnancyStatus").addClass('isRequired');
		<?php } ?>
		var start = new Date();
		var _dobstart = new Date();
		var _dobend = new Date();
		start.setFullYear(start.getFullYear() - 1);
		_dobstart.setFullYear(_dobstart.getFullYear() - 120);
		_dobend.setFullYear(_dobend.getFullYear() - 15);
		$('#dob').datepicker({
			format: 'dd-M-yyyy',
			clearBtn: true,
			todayHighlight: true,
			autoclose: true,
			startDate: _dobstart,
			endDate: _dobend
		});

		$('#sampleReceiptDate').datepicker({
			format: 'dd-M-yyyy',
			clearBtn: true,
			todayHighlight: true,
			autoclose: true,
			startDate: start,
			endDate: "0"
		});
		$('#hivRecencyTestDate,#hivDiagnosisDate,#vlTestDate').datepicker({
			format: 'dd-M-yyyy',
			clearBtn: true,
			todayHighlight: true,
			autoclose: true,
			startDate: start,
			endDate: "0"
		});
		$('#sampleCollectionDate').datepicker({
			format: 'dd-M-yyyy',
			clearBtn: true,
			todayHighlight: true,
			autoclose: true,
			startDate: start,
			endDate: "0"
		}).on('changeDate', function(e) {
			$('#sampleReceiptDate,#hivRecencyTestDate,#hivDiagnosisDate,#vlTestDate').val('');
			var _satrt = new Date(e.date.valueOf());
			$('#sampleReceiptDate,#hivRecencyTestDate,#hivDiagnosisDate,#vlTestDate').datepicker('setStartDate', _satrt);
		});
		// Auto calling checkHivTesting function while edit
		$('#pastHivTesting option[selected="selected"]').each(function() {
			checkHivTesting(this);
		});
	});

	function changeTermLine() {
		var ctrlLine = $("#controlLine").val(),
			postiveLine = $("#positiveVerificationLine").val(),
			longTermLine = $("#longTermVerificationLine").val(),
			vlDataResult = $("#vlLoadResult").val();
		$('.actualresult').css('display', 'none');

		if (ctrlLine != '' && postiveLine != '' && longTermLine != '') {
			if (ctrlLine == 'absent' && postiveLine == 'absent' && longTermLine == 'absent') {
				$("#outcome").html('Invalid – Please Verify').css({
					"color": "<?php echo $lineOutComeColor; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});
				$('.actualresult').css('display', 'inherit');
				$('.actualresult-input').addClass('isRequired');
				updateVlResultFields();

			} else if (ctrlLine == 'absent' && postiveLine == 'absent' && longTermLine == 'present') {
				$("#outcome").html('Invalid – Please Verify').css({
					"color": "<?php echo $lineOutComeColor; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});
				$('.actualresult').css('display', 'inherit');
				$('.actualresult-input').addClass('isRequired');
				updateVlResultFields();

			} else if (ctrlLine == 'absent' && postiveLine == 'present' && longTermLine == 'absent') {
				$("#outcome").html('Invalid – Please Verify').css({
					"color": "<?php echo $lineOutComeColor; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});
				$('.actualresult').css('display', 'inherit');
				$('.actualresult-input').addClass('isRequired');
				updateVlResultFields();

			} else if (ctrlLine == 'absent' && postiveLine == 'present' && longTermLine == 'present') {
				$("#outcome").html('Invalid – Please Verify').css({
					"color": "<?php echo $lineOutComeColor; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});
				$('.actualresult').css('display', 'inherit');
				$('.actualresult-input').addClass('isRequired');
				updateVlResultFields();

			} else if (ctrlLine == 'present' && postiveLine == 'absent' && longTermLine == 'absent') {
				$("#outcome").html('Assay Negative').css({
					"color": "<?php echo $lineOutComeColor; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});

				updateVlResultFields('Assay Negative');

			} else if (ctrlLine == 'present' && postiveLine == 'absent' && longTermLine == 'present') {
				$("#outcome").html('Invalid – Please Verify').css({
					"color": "<?php echo $lineOutComeColor; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});
				$('.actualresult').css('display', 'inherit');
				$('.actualresult-input').addClass('isRequired');
				updateVlResultFields();

			} else if (ctrlLine == 'present' && postiveLine == 'present' && longTermLine == 'absent') {
				$("#outcome").html('Assay Recent - Please ensure you add Viral Load Result').css({
					"color": "<?php echo $lineOutComeColor2; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});

				updateVlResultFields('Assay Recent');

			} else if (ctrlLine == 'present' && postiveLine == 'present' && longTermLine == 'present') {
				$("#outcome").html('Long Term').css({
					"color": "<?php echo $lineOutComeColor2; ?>"
				});
				$(".outcome").css({
					"visibility": "visible"
				});

				updateVlResultFields('Long Term');
			}
		} else {
			$("#outcome").html('');
			$(".outcome", "#outcome").css({
				"visibility": "hidden"
			});
			$("#vlResultoutcome").html('');
			$(".vlResultoutcome").css({
				"visibility": "hidden"
			});
		}
	}

	function changeTermLineActual() {
		var _ctrl = $("#controlLineActual"),
			_postive = $("#positiveVerificationLineActual"),
			_longTerm = $("#longTermVerificationLineActual"),
			_outcome = $(".outcomeActual"),
			_outcomeId = $("#outcomeActual"),
			_outcomeData = $("#outcomeDataActual"),
			_color = '<?php echo $lineOutComeColor; ?>';

		if (_ctrl.val() != '' && _postive.val() != '' && _longTerm.val() != '') {
			if (_ctrl.val() == 'absent' && _postive.val() == 'absent' && _longTerm.val() == 'absent') {
				_outcomeId.html('Invalid – Please Verify').css({
					"color": _color
				});
				_outcome.css({
					"visibility": "visible"
				});
				_outcomeData.val('Invalid');
				updateVlResultFields();
			} else if (_ctrl.val() == 'absent' && _postive.val() == 'absent' && _longTerm.val() == 'present') {
				_outcomeId.html('Invalid – Please Verify').css({
					"color": _color
				});
				_outcome.css({
					"visibility": "visible"
				});
				_outcomeData.val('Invalid');
				updateVlResultFields();
			} else if (_ctrl.val() == 'absent' && _postive.val() == 'present' && _longTerm.val() == 'absent') {
				_outcomeId.html('Invalid – Please Verify').css({
					"color": _color
				});
				_outcome.css({
					"visibility": "visible"
				});
				_outcomeData.val('Invalid');
				updateVlResultFields();
			} else if (_ctrl.val() == 'absent' && _postive.val() == 'present' && _longTerm.val() == 'present') {
				_outcomeId.html('Invalid – Please Verify').css({
					"color": _color
				});
				_outcome.css({
					"visibility": "visible"
				});
				_outcomeData.val('Invalid');
				updateVlResultFields();
			} else if (_ctrl.val() == 'present' && _postive.val() == 'absent' && _longTerm.val() == 'absent') {
				_outcomeId.html('Assay Negative').css({
					"color": _color
				});
				_outcome.css({
					"visibility": "visible"
				});
				updateVlResultFields('Assay Negative');
			} else if (_ctrl.val() == 'present' && _postive.val() == 'absent' && _longTerm.val() == 'present') {
				_outcomeId.html('Invalid – Please Verify').css({
					"color": _color
				});
				_outcome.css({
					"visibility": "visible"
				});
				_outcomeData.val('Invalid');
				updateVlResultFields();
			} else if (_ctrl.val() == 'present' && _postive.val() == 'present' && _longTerm.val() == 'absent') {
				_outcomeId.html('Assay Recent - Please ensure you add Viral Load Result').css({
					"color": "<?php echo $lineOutComeColor2; ?>"
				});
				_outcome.css({
					"visibility": "visible"
				});
				_outcomeData.val('Assay Recent');
				updateVlResultFields('Assay Recent');
			} else if (_ctrl.val() == 'present' && _postive.val() == 'present' && _longTerm.val() == 'present') {
				_outcomeId.html('Long Term').css({
					"color": "<?php echo $lineOutComeColor2; ?>"
				});
				_outcome.css({
					"visibility": "visible"
				});
				updateVlResultFields('Long Term');
			}
		} else {
			_outcomeId.html('');
			$(".outcomeActual", "#outcomeActual").css({
				"visibility": "hidden"
			});
			$("#vlResultoutcome").html('');
			$(".vlResultoutcome").css({
				"visibility": "hidden"
			});
		}
	}

	function updateVlResultFields(fieldValue = null) {
		var vlDataResult = $("#vlLoadResult").val();
		var vlResultOption = $("#vlResultOption").val();

		$("#vlResultoutcome").html('');
		$(".vlResultoutcome").css({
			"visibility": "hidden"
		});

		if (fieldValue == 'vlField') {
			if ($("#outcomeActual").text() != '') {
				var fieldValue = $("#outcomeActual").text();
			} else {
				var fieldValue = $("#outcome").text();
			}
			if (fieldValue == 'Assay Recent - Please ensure you add Viral Load Result') {
				fieldValue = 'Assay Recent';
			}
		}

		if (fieldValue == 'Long Term' || fieldValue == 'Assay Recent' || fieldValue == 'Assay Negative') {

			if (fieldValue == 'Assay Negative') {
				$("#vlResultoutcome").html('Inconclusive').css({
					"color": "<?php echo $lineOutComeColor2; ?>"
				});
				$(".vlResultoutcome").css({
					"visibility": "visible"
				});
				$(".vlResultFields").prop('disabled', true);
				$("#vlTestDate").val('');
				$("#vlLoadResult").val('');
			}
			if (fieldValue == 'Long Term') {
				$("#vlResultoutcome").html('Long Term').css({
					"color": "<?php echo $lineOutComeColor2; ?>"
				});
				$(".vlResultoutcome").css({
					"visibility": "visible"
				});
				$(".vlResultFields").prop('disabled', true);
				$("#vlTestDate").val('');
				$("#vlLoadResult").val('');
			}
			if (fieldValue == 'Assay Recent') {
				$(".vlResultFields").prop('disabled', false);
				<?php if (in_array("Viral Load Test Date", $resultArr2)) { ?>
					$("#vlTestDate").addClass('<?php echo $vlTestDate; ?>');
				<?php  }
				if (in_array("Viral Load Result", $resultArr2)) { ?>
					$("#vlLoadResult").addClass('<?php echo $vlLoadResult; ?>');
				<?php } ?>
				if (vlDataResult > 1000 && vlDataResult != '') {
					$("#vlResultoutcome").html('RITA Recent').css({
						"color": "<?php echo $lineOutComeColor2; ?>"
					});
					$(".vlResultoutcome").css({
						"visibility": "visible"
					});
					$("#vlResultOption").prop('disabled', true);
				} else if (vlDataResult <= 1000 && vlDataResult != '') {
					$("#vlResultoutcome").html('Long Term').css({
						"color": "<?php echo $lineOutComeColor2; ?>"
					});
					$(".vlResultoutcome").css({
						"visibility": "visible"
					});
					$("#vlResultOption").prop('disabled', true);
				} else if (vlResultOption != '' && vlResultOption == 'failed') {
					$("#vlResultoutcome").html('Inconclusive').css({
						"color": "<?php echo $lineOutComeColor2; ?>"
					});
					$(".vlResultoutcome").css({
						"visibility": "visible"
					});
					$("#vlLoadResult").prop('disabled', true);
				} else if (vlResultOption != '') {
					$("#vlResultoutcome").html('Long Term').css({
						"color": "<?php echo $lineOutComeColor2; ?>"
					});
					$(".vlResultoutcome").css({
						"visibility": "visible"
					});
					$("#vlLoadResult").prop('disabled', true);
				}
			}
		} else {
			$(".vlResultFields").prop('disabled', true);
			$("#vlTestDate").removeClass('<?php echo $vlTestDate; ?>');
			$("#vlLoadResult").removeClass('<?php echo $vlLoadResult; ?>');
			$("#vlResultoutcome").html('');
			$("#vlResultOption").val('');
			$(".vlResultoutcome").css({
				"visibility": "hidden"
			});
		}
	}

	function checkHivTesting(obj) {
		if (obj.value == 'yes') {
			$(".hivResultStatusShow").css('display', 'block');
			$("#lastHivStatus").addClass('isRequired');
			$("#testLast12Month").addClass('isRequired');

		} else {
			$(".hivResultStatusShow").css('display', 'none');
			$("#lastHivStatus").removeClass('isRequired');
			$("#patientOnArt").removeClass('isRequired');
			$("#testLast12Month").removeClass('isRequired');

		}
	}

	function genderCheck(obj) {
		if (obj.value == 'male') {
			$(".hidePregnancyResult").css('display', 'none');
			$("#pregnancyStatus").removeClass('isRequired');
			$("#pregnancyStatus").val('');

		} else {
			$(".hidePregnancyResult").css('display', 'block');
			$("#pregnancyStatus").addClass('isRequired');
			$("#pregnancyStatus").val('');
		}
	}

	function checkHivStatus(obj) {
		if (obj.value == 'positive') {
			$("#patientOnArt").attr("disabled", false).addClass('isRequired');
		} else {
			$("#patientOnArt").attr("disabled", true).removeClass('isRequired').val("");
		}
	}

	function otherRecencyTestNotPerfomedCheck(obj) {
		if (obj.value == 'other') {
			$("#otherRecencyTestNotPerformed").css('display', 'block');
			$("#otherRecencyTestNotPerformed").addClass('isRequired');

		} else {
			$("#otherRecencyTestNotPerformed").css('display', 'none');
			$("#otherRecencyTestNotPerformed").removeClass('isRequired');
		}
	}

	jQuery(document).ready(function($) {
		onloadTestKitLot();
		if ($("#vlLoadResult")) {
			$("#vlLoadResult").on('keyup keypress blur change paste', function() {
				if ($('#vlLoadResult').val() != $('#vlLoadResult').val().replace(/[^\d\.]/g, "")) {
					$('#vlLoadResult').val('');
					alert('Please enter only numeric values for Viral Load Result')
				}
			});
		}

		changeTermLine();
		changeTermLineActual();
		$("#facilityId").select2({
			placeholder: "Choose Facility",
			width: "250px",
			allowClear: true,
		});
		updateVlResultFields('vlField');
		$("#wizard-progress-step1 .isRequired").each(function() {
			($(this).val() == '') ? $('.stepOne').css('visibility', 'hidden'): $('.stepOne').css('visibility', 'visible')
		});
		$("#wizard-progress-step2 .isRequired").each(function() {
			($(this).val() == '') ? $('.stepTwo').css('visibility', 'hidden'): $('.stepTwo').css('visibility', 'visible')
		});

		if ($('input[id=recencyTestPerformedYes]').prop('checked') == true) {
			$(".disbaledResult").attr("disabled", true).removeClass("isRequired");
			$(".hideDiv").css('visibility', 'visible');
		} else {
			if ($("#controlLineActual").val() == '') {
				$(".disbaledResult").attr("disabled", false).addClass("isRequired");
			} else {
				$(".disbaledResult").attr("disabled", true).removeClass("isRequired");
			}
			$(".hideDiv").css('visibility', 'hidden');
		}

		$('#recencyTestPerformedYes').change(function() {
			if (this.checked == true) {
				$("#outcome").html('');
				$(".outcome", "#outcome").css({
					"visibility": "hidden"
				});

				$("#vlResultoutcome").html('');
				$(".vlResultoutcome").css({
					"visibility": "hidden"
				});

				$(".vlResultFields").prop('disabled', true);

				$("#vlTestDate").removeClass('isRequired');
				$("#vlLoadResult").removeClass('isRequired');

				$("#vlTestDate").val('');
				$("#vlLoadResult").val('');
				$("#vlResultOption").val('');

				$(".disbaledResult").attr("disabled", true).removeClass("isRequired").val("");

				$(".hideDiv").css({
					"visibility": "visible"
				});
				$("#recencyTestNotPerformed").addClass("isRequired");

				$(".disbaledResult").attr("disabled", true).removeClass("isRequired").val("");
				$(".hideDiv").css('visibility', 'visible');
				$("#recencyTestNotPerformed").addClass("isRequired");
			} else {
				if ($("#controlLineActual").val() == '') {
					$(".disbaledResult").attr("disabled", false).addClass("isRequired");
				} else {
					$(".disbaledResult").attr("disabled", true).removeClass("isRequired");
				}
				$(".hideDiv").css('visibility', 'hidden');
				$("#recencyTestNotPerformed").val("").removeClass("isRequired");
				$("#otherRecencyTestNotPerformed").val("").removeClass("isRequired");
				$("#hivRecencyTestDate").addClass("<?php echo $hivRecencyTestDate; ?>");
				$("#controlLine").addClass("<?php echo $controlLineResult; ?>");
				$("#positiveVerificationLine").addClass("<?php echo $positiveVerificationLine; ?>");
				$("#longTermVerificationLine").addClass("<?php echo $longTermVerificationLine; ?>");
			}
		});

		<?php
		foreach ($globalConfigResult as $config) {
			if ($config['global_name'] == 'location_one') {
		?>
				getLocationDeatils('<?php echo $config["global_name"]; ?>', '<?php echo $result['location_one']; ?>', null, null, 'onload');
			<?php
			} else if ($config['global_name'] == 'location_two') {
			?>
				getLocationDeatils('<?php echo $config["global_name"]; ?>', '<?php echo $result['location_one']; ?>', '<?php echo $result['location_two']; ?>', null, 'onload');
			<?php
			} else if ($config['global_name'] == 'location_three') {
			?>
				getLocationDeatils('<?php echo $config["global_name"]; ?>', '<?php echo $result['location_one']; ?>', '<?php echo $result['location_two']; ?>', '<?php echo $result['location_three']; ?>', 'onload');
		<?php
			}
		}
		?>

		$("#facilityId").change(function() {
			if ($(this).val() == 'other') {
				$("#otherFacilityName").addClass("isRequired").show();
			} else {
				$("#otherFacilityName").removeClass("isRequired").hide();
			}
		});


		$("#testingFacilityId").change(function() {
			if ($(this).val() == 'other') {
				$("#otherTestingFacility").addClass("isRequired").show();
			} else {
				$("#otherTestingFacility").removeClass("isRequired").hide();
			}
		});

		$("#testingModality").change(function() {
			if ($(this).val() == 'other') {
				$("#othertestingmodality").addClass("isRequired").show();
			} else {
				$("#othertestingmodality").removeClass("isRequired").hide();
			}
		});

		<?php if ($result['past_hiv_testing'] == 'yes') { ?>
			$(".hivResultStatusShow").css('display', 'block');
			$("#lastHivStatus").addClass('isRequired');
			$("#testLast12Month").addClass('isRequired');
		<?php } else { ?>
			$(".hivResultStatusShow").css('display', 'none');
			$("#lastHivStatus").removeClass('isRequired');
			$("#patientOnArt").removeClass('isRequired');
			$("#testLast12Month").removeClass('isRequired');

		<?php }
		if ($result['last_hiv_status'] == 'positive') { ?>
			$("#patientOnArt").attr("disabled", false);
			$("#lastHivStatus", "#patientOnArt").addClass('isRequired');
		<?php } else { ?>
			$("#patientOnArt").attr("disabled", true).removeClass('isRequired');
		<?php } ?>
	});

	function validateStep1() {
		$("html, body").animate({
			scrollTop: 150
		}, 300);
		if (($("#sampleId").val() != "") || ($("#patientId").val() != "")) {
			flag = deforayValidator.init({
				formId: 'recencyInformation'
			});

		} else {
			$("#sampleId").focus();
			$("#sampleId").css("border", "1px solid rgb(207, 51, 57)");
			alert("Please enter either sample or patient id  ", 'err');
		}

		$("#dob").addClass("<?php echo $dob; ?>");
		$("#gender").addClass("<?php echo $gender; ?>");
		$("#age").addClass("<?php echo $age; ?>");
		$("#residence").addClass("<?php echo $residence; ?>");
		$("#maritalStatus").addClass("<?php echo $marital; ?>");
		$("#educationLevel").addClass("<?php echo $education; ?>");
		$("#riskPopulation").addClass("<?php echo $risk; ?>");
		$("#currentSexualPartner").addClass("<?php echo $partner; ?>");
		$("#expViolence").addClass("<?php echo $expViolence; ?>");

		$("#step1,#wizard-progress-step1").removeClass("active");
		$("#step2,#wizard-progress-step2").addClass("active");

		$(".btnHide").show();
		$(".nxtBtn").hide();
	}

	function riskPopulationCheck(obj) {
		if (obj.value == 'Other') {
			$("#otherRiskPopulation").css('display', 'block').addClass('isRequired');
		} else {
			vlfinaloutcomeResult
			$("#otherRiskPopulation").css('display', 'none').removeClass('isRequired');
		}
	}

	function validateStep2() {
		$(".section2").removeClass('isRequired');
		$("#step1,#wizard-progress-step1").addClass("active");
		$("#step2,#wizard-progress-step2").removeClass("active");

		$(".btnHide").hide();
		$(".nxtBtn").show();
	}

	function validateNow() {
		if (($("#sampleId").val() != "") || ($("#patientId").val() != "")) {
			//    if( ( $("#dob").val() != "" ) || ( $("#age").val() != "" ) ){
			flag = deforayValidator.init({
				formId: 'recencyInformation'
			});
			//document.getElementById("outcomeData").value=document.getElementById("outcome").innerHTML;

			document.getElementById("outcomeData").value = document.getElementById("outcome").innerHTML;
			if (document.getElementById("outcome").innerHTML == 'Assay Recent - Please ensure you add Viral Load Result') {
				document.getElementById("outcomeData").value = 'Assay Recent';
			}
			if (document.getElementById("outcome").innerHTML == 'Invalid – Please Verify') {
				document.getElementById("outcomeData").value = 'Invalid';
			}
			document.getElementById("vlfinaloutcomeResult").value = document.getElementById("vlResultoutcome").innerHTML;

			if (flag) {
				$.blockUI();
				document.getElementById('recencyInformation').submit();
			}
			//    } else{
			// 		$("#age").focus();
			// 		$("#age").css("border","1px solid rgb(207, 51, 57)");
			// 		alert("Please enter either DOB or age  ",'err');
			//    }
		} else {
			$("#sampleId").focus();
			$("#sampleId").css("border", "1px solid rgb(207, 51, 57)");
			alert("Please enter eaither sample or patient id  ", 'err');
		}
	}

	function ageCalculate() {
		var agYrs = '';
		var agMnths = '';
		var dob = changeFormat($("#dob").val());
		if ($.trim(dob) != '') {
			//calculate age
			var years = moment().diff(dob, 'years', false);
			var months = (years == 0) ? moment().diff(dob, 'months', false) : '';
			$("#age").val(years); // Gives difference as years
		}
	}

	function changeFormat(date) {
		splitDate = date.split("-");
		var fDate = new Date(splitDate[1] + splitDate[2] + ", " + splitDate[0]);
		var monthDigit = fDate.getMonth();
		var fMonth = isNaN(monthDigit) ? 1 : (parseInt(monthDigit) + parseInt(1));
		fMonth = (fMonth < 10) ? '0' + fMonth : fMonth;
		return splitDate[2] + '-' + fMonth + '-' + splitDate[0];
	}

	function getLocationDeatils(globalName, value1, value2, value3, load = null) {
		var selectValue = document.getElementById(globalName).value;
		var innerId = '';
		var path = '';
		var selectedValue = '';
		if (value1 != null || value2 != null || value3 != null) {
			if (globalName == 'location_one') {
				path = 'get-province';
				innerId = 'location_one';
				selectValue = value1;
				selectedValue = value1;
			} else if (globalName == 'location_two') {
				path = 'get-district';
				innerId = 'location_two';
				selectValue = value1;
				selectedValue = value2;
			} else if (globalName == 'location_three') {
				path = 'get-city';
				innerId = 'location_three';
				selectValue = value2;
				selectedValue = value3;
			}
		} else {
			if (globalName == 'location_one' && selectValue == '') {
				path = 'get-province';
				innerId = 'location_one';
			} else if (globalName == 'location_one' && selectValue != '') {
				path = 'get-district';
				innerId = 'location_two';
				$("#location_three").html("<option value=''>-- Select --</option>");
			} else if (globalName == 'location_two' && selectValue != '') {
				path = 'get-city';
				innerId = 'location_three';
				if (selectValue == 'other') {
					$("#otherDistrictName").show();
					$("#otherDistrictName").addClass('isRequired');
				} else {
					$("#otherDistrictName").hide();
					$("#otherDistrictName").removeClass('isRequired');
				}
			} else if (globalName == 'location_three' && selectValue != '') {
				path = 'get-facility';
				if (selectValue == 'other') {
					$("#otherCityName").show();
					$("#otherCityName").addClass('isRequired');
				} else {
					$("#otherCityName").hide();
					$("#otherCityName").removeClass('isRequired');
				}
			}
		}
		if (path != '') {
			$.blockUI();
			$.post("/common/" + path, {
					selectValue: selectValue
				},
				function(data) {

					if (globalName == 'location_one' && selectValue != '') {
						var splitOption = data.split("##");
						$("#" + innerId).html(splitOption[0]);
						if (load == null) {
							$("#facilityId").html(splitOption[1]);
						}
					} else if (globalName == 'location_two' && selectValue != '') {
						var splitOption = data.split("##");
						$("#" + innerId).html(splitOption[0]);
						if (load == null) {
							$("#facilityId").html(splitOption[1]);
						}
					} else if (globalName == 'location_three' && selectValue != '') {
						if (load == null) {
							$("#facilityId").html(data);
						}
					} else {
						$("#" + innerId).html(data);
					}
					if (selectedValue != '') {
						$("#" + innerId).val(selectedValue);
					}
					$.unblockUI();
				});
		}
	}

	function getLocationDataByFacility() {
		var facilityId = $("#facilityId").val();
		if (facilityId != '' && facilityId != 'other') {
			//$.blockUI();
			$.post("/recency/get-location-based-facility", {
					facilityId: facilityId
				},
				function(data) {
					jsonData = JSON.parse(data);
					if (typeof jsonData.province != "undefined" && jsonData.province != '') {
						$("#location_one").html("<option value=''>-- Select --</option><option value='" + jsonData.province + "' selected>" + jsonData.province_name + "</option>");
					}
					if (typeof jsonData.district != "undefined" && jsonData.district != '') {
						$("#location_two").html("<option value=''>-- Select --</option><option value='" + jsonData.district + "' selected>" + jsonData.district_name + "</option>");
					}
					if (typeof jsonData.city != "undefined" && jsonData.city != '') {
						$("#location_three").html("<option value=''>-- Select --</option><option value='" + jsonData.city + "' selected>" + jsonData.city_name + "</option>");
					}
				});
		}
	}

	function testKitLotNoChange(obj) {
		if ($('#testKitLotNo').val() != "") {
			$.post('/recency/get-kit-lot-info', {
					kitNo: $('#testKitLotNo').val()
				},
				function(data) {
					if (data != "") {
						var objects = JSON.parse(data)
						objects.forEach(function(key, index) {
							$('#testKitExpDate').val(key.kit_expiry_date);
						});
					}
				});
		} else {
			$('#testKitExpDate').val('');
		}
	}

	function minmax(value, min, max) {
		if (parseInt(value) < min || isNaN(parseInt(value))) {
			return min;
		} else if (parseInt(value) > max) {
			return max;
		} else return value;
	}

	function ageNotReport(obj) {
		if ($(obj).prop('checked') == true) {
			$('#dob,#age').val('');
			$('#dob,#age').prop('disabled', true);
			$('#dob,#age').removeClass('isRequired');
		} else {
			$('#age').addClass('isRequired');
			$('#dob,#age').prop('disabled', false);
		}
	}
	if ($("#controlLineActual").val() == '') {
		$(".disbaledResult").attr("disabled", false).addClass("isRequired");
	} else {
		$(".disbaledResult").attr("disabled", true).removeClass("isRequired");
	}

	function checkPatientIdValidation() {
		checkValue = document.getElementById('patientId').value;
		if ($.trim(checkValue) != '') {
			$.post('/recency/check-patient-id-validation', {
					value: checkValue,
					editPatientId: editPatientId
				},
				function(data) {
					if (data != "") {
						var confrm = confirm(data);
						if (!confrm) {
							document.getElementById('patientId').value = "";
						}
					}
				});
		}
	}
	$('#patientId').on('input', function() {
		var trimInputValue = $(this).val().trim();
		var inputValue = trimInputValue.replace(/[^\w\s]/gi, ''); // Remove any special characters
		var inputLength = inputValue.length;

		if (inputLength > 19) {
			$(".patientIdError").show();
		} else if (inputLength < 19) {
			$(".patientIdError").show();
			$(this).val(trimInputValue);
		} else {
			$(".patientIdError").hide();
			$(this).val(trimInputValue);
		}
	});

	function getTestKitLot() {
		if ($('#hivRecencyTestDate').val() != "") {
			$.post('/recency/get-recency-date-based-test-kit', {
					recencyTestDate: $('#hivRecencyTestDate').val()
				},
				function(data) {
					if (data != "") {
						$('#testKitLotNo').html(data);
					}
				});
		}
	}

	function onloadTestKitLot() {
		if ($('#hivRecencyTestDate').val() != "") {
			$.post('/recency/get-recency-date-based-test-kit', {
					recencyTestDate: $('#hivRecencyTestDate').val()
				},
				function(data) {
					if (data != "") {
						$('#testKitLotNo').html(data);
						$("#testKitLotNo").val("<?php echo $result['kit_lot_no'] ?>");
					}
				});
		}
	}
</script>
